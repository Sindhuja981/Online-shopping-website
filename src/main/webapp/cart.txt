<%@page import="com.example.model.product"%>
<%@page import="com.example.model.*"%>
<%@page import="java.util.List"%>
<%@page import="com.example.model.Cart"%>
<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
	pageEncoding="ISO-8859-1"%>
<!DOCTYPE html>
<html>
<head>
<jsp:include page='../Header.jsp'></jsp:include>
<title>Cart</title>

<meta name="viewport" content="width=device-width, initial-scale=1">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
	rel="stylesheet">

<script language="javascript">
	function calculateBillAmount(amount, rowNo,gstAmount, nRows){
		//alert("ok" + amount);
		//alert(rowNo);
		
		let qty = parseInt(document.getElementById('qty'+rowNo).value);
		
		//alert("qty" + qty);
		let billAmount = amount * qty;
		
		document.getElementById('billAmount'+rowNo).value = billAmount;
		let gst = parseInt(gstAmount) * qty;
		document.getElementById('gst'+rowNo).value =  qty;
		
		document.getElementById('finalAmount'+rowNo).value =  parseInt(document.getElementById('billAmount'+rowNo).value) + parseInt(document.getElementById('gst'+rowNo).value);
		//total Calculation 
		let totalQuantity =0;
		let totalBillAmount =0;
		let totalGst =0;
		let totalFinalAmount =0;
		for(i=1; i<=parseInt(nRows); i++){
			let CurrentBillAmount = parseInt(document.getElementById('billAmount'+i).value);
			let currentGst = parseInt(document.getElementById('gst'+i).value);
			let currentFinalAmount = parseInt(document.getElementById('finalAmount'+ i).value);
			
			totalQuantity += parseInt(document.getElementById('qty'+i));
			totalBillAmount += isNaN(currentGst) ? 0 : currentBillAmount;
			totalGst += isNaN(currentGst) ? 0 : currentGst;
			totalFinalAmount += isNaN(currentFinalAmount) ? 0 : currentFinalAmount;		
		}
		document.getElementById("totalQuantity").innerHTML = ""+totalQuantity ;
		document.getElementById("totalBillAmount").innerHTML = ""+ totalBillAmount;
		document.getElementById("totalGst").innerHTML = ""+ totalGst ;
		document.getElementById("totalFinalAmount").innerHTML = ""+ totalFinalAmount;
		
	}
	function confirm_delete(productCode,customerId){
		
		
	}
	
</script>


</head>
<body>

	<%
	Cart cart = new Cart();

	List<product> ListProducts = cart.getAllCartProductsByCustomerId((int) session.getAttribute("customerId"));
	System.out.print(ListProducts.size());
	
	int nRows =  ListProducts.size();
	Integer grandTotal=0;
	int totalQuantity =0;
	int totalBillAmount =0;
	 int totalGst =0;
	int totalFinalAmount =0;
	
	
	%>
	<h2 class="text-center text-danger" >CART</h2>
	<div class="container mt-3"
		style="background-color:#EAB7CF ;height: 500px; width: 1200px;">

		<div class="row">
			<div class="col-md-12">
				<table
					class="table   table-success table-hover table-bordered table-responsive mt-4"
					id="table_id">
					<thead class="table-dark">
						<tr class="text-center">
							<th>slno</th>
							<th>Product Code</th>
							<th>Product Name</th>
							<th>Cost</th>
							<th>Discount(%)</th>
							<th>Amount</th>
							<th>Qty</th>
							<th>Bill Amount</th>
							<th>GSt</th>
							<th>Final Amount</th>
							<th>Operation</th>
						</tr>
					</thead>
					<tbody>
						<%						
						int slno = 0;
						int i=1;
						for (product productOb : ListProducts) {
							slno++;
							Integer cost = productOb.getCost();
							Integer discount = productOb.getDiscount();
							Integer amount = cost - (cost * discount / 100);
							Integer total = amount;
							grandTotal += total;
							Integer billAmount=amount;
							Integer gst = (int) (billAmount * (16/100.0));
							Integer finalAmount = billAmount + gst;
							
							totalQuantity +=1;
							totalBillAmount +=billAmount;
							totalGst +=gst;
							totalFinalAmount +=finalAmount;				
						%>
						<tr>
							<td class="text-center"><%=slno%></td>
							<td class="text-center"><%=productOb.getProductCode()%></td>
							<td class="text-center"><%=productOb.getProductName()%></td>
							<td class="text-end"><%=productOb.getCost()%></td>
							<td class="text-end"><%=productOb.getDiscount()%></td>
							<td class="text-end"><%=amount%></td>
							<td><input type="number" name="qty" min="1" id="qty<%=i%>" class="form-control" value="1" 
							onchange="calculateBillAmount(<%=amount%>,<%=gst %> ,<%=i%>,<%=nRows%>)"  style="width:50px"></td>

							<td><input type="number" name="billAmount" id="billAmount<%=i%>" value="<%=billAmount%>" class="form-control" style="width:150px" readonly></td>

							<td><input type="number" name="gst" id="gst<%=i%>" value="<%=gst%>" class="form-control" style="width:150px"></td>
							<td><input type="number" name="finalAmount" id="finalAmount<%=i%>" value="<%=finalAmount%>" class="form-control" style="width:150px"></td>
							<td></td>
							
						</tr>
						<%
						i++;
						}
						%>
						<tr>
							<td colspan="5" class="text-end"><strong>Total:</strong></td>
							<td class="text-end"><strong><%=grandTotal%></strong></td>
							<td class="text-end" ><strong id='totalQty'><%= totalQuantity %></strong></td>
							<td class="text-end"><strong id='totalBillAmount'><%=totalBillAmount %></strong></td>
							<td class="text-end"><strong id='totalGst'><%=totalGst%></strong>
							<td class="text-end"><strong id='totalFinalAmount'><%=totalFinalAmount%></strong>
							<td></td>
						
						</tr>
						
						
</tbody></br>
</table>
</div>
	<%
		Shipment shipment = new Shipment();
		
	%>

<form name='f1' method='post' action='/ECommerceProject/PaymentServlet'></form>

<div class='container mt-3 card' style="background-color:powderblue;" >
  <div class='card-body'>
  <div class= 'row'>
  <div class='col-sm-6'>
  <form>
 <label for="Address"> Shipping Address:</label><br>
    <textarea id="deliverAddress" name="deliverAddress" rows="5" cols="50" class='form-control'></textarea>
    <div class='col-sm-12'>
    <label for="Mobile no"> Mobile Number:</label>
    <input type='number' name='mobileNumber' class='form-control' >
    </div>
    <div class='row'>
    <div class='col-sm-12'>
    <label for="Zipcode"> Zipcode:</label>
    <input type='number' name='Zipcode' class='form-control' >
    </div>
    </div>
    </form>		
  </div>
 

  <div class='col-sm-6'>
  	 <form>
  	 <center><h2>Payment Mode</h4></center>
  	 	<h5>payment-type:</h5>
        <label for="option1"> online:</label>
        <input type="radio" id="option1" name="options" value="Online">
		
        <label for="option2"> COD:</label>
        <input type="radio" id="option2" name="options" value="COD"><br>
        <div class='row'>
        <div class='col-sm-5'>
        <label for="card-Type">card-Type :</label>
        <input type='text' id='type1' name='type' value=''  class='form-control'>
        </div>
        <div class='col-sm-5'>
        <label for="card-number">card-number :</label>
        <input type='number' id='cnumber' name='cnumber' value=''  class='form-control'>
        </div>
        </div>
        <div class='row'>
        <div class='col-sm-5'>
        <label for="card-pin">card-pin :</label>
        <input type='password' id='password' name='password' value=''  class='form-control'>
        </div>
        <div class='col-sm-5'>
        <label for="CVV No">CVV No :</label>
        <input type='number' id='CVVNo' name='CVVNo' value='' size='10' class='form-control'>
        </div>
        </div>
        <div class='row'>
        <div class='col-sm-5'>
        <label for="Expiry Date">Expiry Date:</label>
        <input type='date' id='ExpiryDate' name='ExpiryDate' value=''  class='form-control'>
        </div>
        </div>
        
        <div class='row mt-4'>
        <div class='col-sm-3'>
        <input type='submit' name='submit' value='payment' class='form-control btn btn-outline-success'>
        </div>
        </div>

    </form>
  </div>
  </div>
  
  </div>
  </div>
  
	</div>
	</div>
		
	
</body>
</html>
							
						